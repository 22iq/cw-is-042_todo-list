#include <libtodolist/get_task.h>
#include <libtodolist/selected_list_type.h>

#include <ctest.h>

CTEST(get_task, check_task_number)
{
    selected_list sl;
    FILE* file = fopen("test.txt", "w+");

    char task0[153]
            = "\0task0~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
              "~"
              "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
              "~~~~~~~~~~~~~~~~~~~~~~~";
    char task1[153]
            = "Xtask1~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
              "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
              "~~~~~~~~~~~~~~~~~~~~~~~";
    fwrite(task0, sizeof(char), 151, file);
    fwrite(task1, sizeof(char), 151, file);

    ASSERT_EQUAL(1, get_task(0, &sl, file));
    ASSERT_EQUAL(0, get_task(1, &sl, file));
    ASSERT_EQUAL(1, get_task(2, &sl, file));

    char task2[153]
            = "\0task2~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
              "~"
              "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
              "~~~~~~~~~~~~~~~~~~~~~~~";
    fseek(file, 302, SEEK_SET);
    fwrite(task2, sizeof(char), 151, file);

    ASSERT_EQUAL(0, get_task(1, &sl, file));
    ASSERT_EQUAL(1, get_task(2, &sl, file));

    char task3[153]
            = "Xtask3~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
              "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
              "~~~~~~~~~~~~~~~~~~~~~~~";
    fseek(file, 453, SEEK_SET);
    fwrite(task3, sizeof(char), 151, file);

    ASSERT_EQUAL(0, get_task(2, &sl, file));
    ASSERT_EQUAL(1, get_task(3, &sl, file));

    char task4[153]
            = "Xtask4~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
              "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
              "~~~~~~~~~~~~~~~~~~~~~~~";
    fseek(file, 604, SEEK_SET);
    fwrite(task4, sizeof(char), 151, file);

    ASSERT_EQUAL(0, get_task(3, &sl, file));
    ASSERT_EQUAL(1, get_task(4, &sl, file));

    char task5[153]
            = "\0task5~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
              "~"
              "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
              "~~~~~~~~~~~~~~~~~~~~~~~";
    fseek(file, 755, SEEK_SET);
    fwrite(task5, sizeof(char), 151, file);

    ASSERT_EQUAL(0, get_task(3, &sl, file));
    ASSERT_EQUAL(1, get_task(4, &sl, file));

    fclose(file);
    remove("test.txt");
}

CTEST(get_task, compare_strings)
{
    selected_list sl;
    FILE* file = fopen("test.txt", "w+");

    sl.name_task[151] = '\0';

    char task0[153]
            = "\0task0~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
              "~"
              "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
              "~~~~~~~~~~~~~~~~~~~~~~~";
    char task1[153]
            = "Xtask1~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
              "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
              "~~~~~~~~~~~~~~~~~~~~~~~";
    char task2[153]
            = "\0task2~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
              "~"
              "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
              "~~~~~~~~~~~~~~~~~~~~~~~";
    char task3[153]
            = "Xtask3~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
              "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
              "~~~~~~~~~~~~~~~~~~~~~~~";
    char task4[153]
            = "Xtask4~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
              "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
              "~~~~~~~~~~~~~~~~~~~~~~~";
    char task5[153]
            = "\0task5~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
              "~"
              "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
              "~~~~~~~~~~~~~~~~~~~~~~~";

    fwrite(task0, sizeof(char), 151, file);
    fwrite(task1, sizeof(char), 151, file);
    fwrite(task2, sizeof(char), 151, file);
    fwrite(task3, sizeof(char), 151, file);
    fwrite(task4, sizeof(char), 151, file);
    fwrite(task5, sizeof(char), 151, file);

    get_task(1, &sl, file);
    ASSERT_STR(
            "Xtask1~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
            "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
            "~~~~~~~~~~~~~~~~~~~",
            sl.name_task);

    get_task(2, &sl, file);
    ASSERT_STR(
            "Xtask3~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
            "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
            "~~~~~~~~~~~~~~~~~~~",
            sl.name_task);

    get_task(3, &sl, file);
    ASSERT_STR(
            "Xtask4~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
            "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
            "~~~~~~~~~~~~~~~~~~~",
            sl.name_task);

    ASSERT_EQUAL(1, get_task(4, &sl, file));

    fclose(file);
    remove("test.txt");
}